<app-loading [condition]="isLoading"></app-loading>

<app-toast [message]="toast.message"></app-toast>

<div class="row margin-empty">
<div class="card col-lg-6 padding-empty" *ngIf="!isEditing">
  <h4 class="">Add new bill </h4>
  <div class="card-body">
    <form class="form-inline bill-form" [formGroup]="addBillForm" (ngSubmit)="addBill()">
      <div class="row" style="width: 100%">
        <div class="col-lg-6 padding-empty">
          <div class="form-field-container">       
            <label class="form-label">Vehicle Number</label>
  <!--         <input class="form-control mr-2" type="number" name="works"
                 formControlName="works" placeholder="Works" min="0"> -->
          <input class="form-control mr-2" type="text" name="vehicleNumber"
                 formControlName="vehicleNumber" placeholder="Enter Vehicle Number" min="0">
          </div>           
          <div class="form-field-container">
            <label class="form-label">Customer Name</label>
          <input class="form-control mr-2" type="text" name="customerName"
                 formControlName="customerName" placeholder="Customer Name" min="0">                                    
          </div>
          <div class="form-field-container">
            <label class="form-label">Phone Number</label>
          <input class="form-control mr-2" type="text" name="phoneNumber"
                 formControlName="phoneNumber" placeholder="Enter Phone Number" min="0">                                    
          </div>
          <div class="form-field-container">
          <label class="form-label">Total Amount</label>  
          <input class="form-control mr-2" type="text" name="amount"
                 formControlName="amount" placeholder="Amount">
           </div>
          <button class="btn btn-primary top-space-10" type="submit" [disabled]="!addBillForm.valid">
            <i class="fa fa-plus"></i> Add
          </button>
        </div>
        <div class=" col-lg-6 padding-empty" >
          <h5 class="">Added Works <span class="total-amount" >Total ({{getTotal(addBillForm.value.works)}})</span></h5>
          <div class="">
            <div>

                  <form [formGroup]="addWorkForm" (ngSubmit)="addNewWork()">
                    <div>
                      <td>

                        <input 
                            type="text"
                            placeholder="Enter Work"
                            formControlName="name" 
                        />
                      </td>
                      <td>

                        <input 
                            type="number"
                            placeholder="Enter Price"
                            formControlName="price" 
                        />
                      </td>
                      <td>
                      <button class="btn btn-sm btn-primary" type="submit" >
                          <!-- <i class="fa fa-pencil"></i> --> Add
                        </button> 
            <!--             <button class="btn btn-sm btn-danger ml-1" (click)="deleteBill(bill)">
                          <i class="fa fa-trash"></i> Delete
                        </button> -->
                      </td>
                    </div>
                </form>
                <div class="error-text" *ngIf="!addWorkForm.valid && addWorkForm.controls.name.touched && addWorkForm.controls.price.touched "> Please enter work, and price </div>
            </div>
            <table class="work-table">
              <thead class="thead-light">
                <tr>
                  <th >Name</th>
                  <th >Price</th>
                  <th >Actions</th>
                </tr>
              </thead>
              <tbody *ngIf="bills.length === 0">
                <tr>
                  <td colspan="4">There are no bills in the DB. Add a new bill below.</td>
                </tr>  
              </tbody>
              <tbody *ngIf="!isEditing">
                
                <tr *ngFor="let work of addBillForm.value.works; let i = index">
                  <td>{{work.name}}</td>
                  <td>{{work.price}}</td>

                  <td>
<!--                       <span (click)="addWork(work)">
                      <i class="fa fa-pencil" ></i>
                    </span> -->
                    <span  (click)="removeWork(i)">
                      <i class="fa fa-trash"></i> 
                    </span>
                  </td>
                </tr>  
              </tbody>
             <!--  <tbody *ngIf="isEditing">
                <tr>
                  <td colspan="4">
                    <form class="form-inline" #form="ngForm" (ngSubmit)="editBill(bill)">
                      <input class="form-control mr-2" type="text" name="name"
                             [(ngModel)]="work.amount" placeholder="Name" required>
                      <input class="form-control mr-2" type="number" name="price"
                             [(ngModel)]="wor.works.length" placeholder="Price" min="0" required>
                      <button class="btn btn-sm btn-primary mr-2" type="submit" [disabled]="!form.form.valid">
                        <i class="fa fa-floppy-o"></i> Save
                      </button>
                      <button class="btn btn-sm btn-warning" (click)="cancelEditing()">
                        <i class="fa fa-times"></i> Cancel
                      </button>
                    </form>
                  </td>
                </tr>
              </tbody> -->
            </table>


               <table class="work-table">
<!--               <thead class="thead-light">
                <tr>
                  <th >Name</th>
                  <th >Price</th>
                  <th >Actions</th>
                </tr>
              </thead>
              <tbody *ngIf="bills.length === 0">
                <tr>
                  <td colspan="4">There are no spares added. Add a new spare.</td>
                </tr>  
              </tbody> -->
              <!-- <tbody *ngIf="!isEditing"> -->
                
                <div >
                  

                    <div class="added-spare" *ngFor="let spare of addBillForm.value.spares; let i = index">
                      {{spare.name}}({{spare.price}} -/ Rs)    
                      <i class="fa fa-trash black" (click)="removeSpare(i)"></i> 
                    </div>
                  
                </div>  
              <!-- </tbody> -->
             <!--  <tbody *ngIf="isEditing">
                <tr>
                  <td colspan="4">
                    <form class="form-inline" #form="ngForm" (ngSubmit)="editBill(bill)">
                      <input class="form-control mr-2" type="text" name="name"
                             [(ngModel)]="work.amount" placeholder="Name" required>
                      <input class="form-control mr-2" type="number" name="price"
                             [(ngModel)]="wor.works.length" placeholder="Price" min="0" required>
                      <button class="btn btn-sm btn-primary mr-2" type="submit" [disabled]="!form.form.valid">
                        <i class="fa fa-floppy-o"></i> Save
                      </button>
                      <button class="btn btn-sm btn-warning" (click)="cancelEditing()">
                        <i class="fa fa-times"></i> Cancel
                      </button>
                    </form>
                  </td>
                </tr>
              </tbody> -->
            </table>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
<div class="card mb-3 col-lg-6 padding-empty" *ngIf="!isLoading">
  <div class="row">
  
  <div class="card-body col-lg-6">
    <h4 class="">Current Spares ({{spares.length}})</h4>
    <table class="work-table">
      <thead class="thead-light">
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody *ngIf="bills.length === 0">
        <tr>
          <td colspan="4">There are no spares in the DB. Add a new spare below.</td>
        </tr>  
      </tbody>
      <tbody *ngIf="!isEditing">
        <tr *ngFor="let spare of spares">
          <td>{{spare.name}}({{spare.availableItems}})</td>
          <!-- <td>{{work.price}}</td> -->

          <td>
            <button class="btn btn-sm btn-primary" (click)="addSpare(spare)">
              <i class="fa fa-pencil"></i> Add
            </button> 
<!--             <button class="btn btn-sm btn-danger ml-1" (click)="deleteBill(bill)">
              <i class="fa fa-trash"></i> Delete
            </button> -->
          </td>
        </tr>  

      </tbody>

    </table>
  </div>
  <div class="card-body col-lg-6">
    <h4 class="">Current Works ({{works.length}})</h4>
    <table class="work-table">
      <thead class="thead-light">
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Price</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody *ngIf="bills.length === 0">
        <tr>
          <td colspan="4">There are no bills in the DB. Add a new bill below.</td>
        </tr>  
      </tbody>
      <tbody *ngIf="!isEditing">
        <tr *ngFor="let work of works">
          <td>{{work.name}}</td>
          <td>{{work.price}}</td>

          <td>
            <button class="btn btn-sm btn-primary" (click)="addWork(work)">
              <i class="fa fa-pencil"></i> Add
            </button> 
<!--             <button class="btn btn-sm btn-danger ml-1" (click)="deleteBill(bill)">
              <i class="fa fa-trash"></i> Delete
            </button> -->
          </td>
        </tr>  

      </tbody>

    </table>
  </div>
</div>
</div>
</div>